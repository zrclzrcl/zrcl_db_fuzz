-- 创建测试表
CREATE TABLE test_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    age INTEGER,
    email TEXT UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 插入测试数据
INSERT INTO test_table (name, age, email) VALUES 
('Alice', 30, 'alice@example.com'),
('Bob', 25, 'bob@example.com'),
('', 0, ''), -- 测试空字符串和边界值
('Charlie', NULL, NULL); -- 测试NULL值

-- 创建包含特殊字符的测试表
CREATE TABLE special_chars (
    id SERIAL PRIMARY KEY,
    data TEXT
);

-- 插入包含特殊字符的数据
INSERT INTO special_chars (data) VALUES 
('%', '_', 'test''ing', '"test"', '-- comment');

-- 复杂查询示例
SELECT * FROM test_table WHERE age > 25 AND name LIKE 'A%';
SELECT COUNT(*) FROM test_table GROUP BY age HAVING COUNT(*) > 1;
SELECT t1.name, t2.data FROM test_table t1 JOIN special_chars t2 ON t1.id = t2.id;

-- 更新和删除操作
UPDATE test_table SET email = 'updated@example.com' WHERE id = 1;
DELETE FROM test_table WHERE name LIKE '%';

-- 创建索引
CREATE INDEX idx_age ON test_table (age);

-- 事务控制示例
BEGIN;
    INSERT INTO test_table (name, age) VALUES ('Transaction Test', 42);
COMMIT;

-- 子查询和联合查询
SELECT * FROM test_table WHERE id IN (SELECT id FROM special_chars WHERE data = 'test');
(SELECT name FROM test_table UNION SELECT data FROM special_chars) LIMIT 5;