-- 创建测试表并插入示例数据
CREATE TABLE test_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    age INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN
);

INSERT INTO test_table (name, age, is_active) VALUES 
('Alice', 30, TRUE),
('Bob', 25, FALSE),
('Charlie', NULL, TRUE),  -- 测试NULL值处理
('David', 45, TRUE); 

-- 复杂查询示例，包含子查询、联合、连接和窗口函数
SELECT t1.name, t1.age, t2.avg_age 
FROM test_table t1
JOIN (
    SELECT name, AVG(age) as avg_age
    FROM test_table
    GROUP BY name
) t2 ON t1.name = t2.name
WHERE t1.is_active = TRUE
ORDER BY t1.age DESC;

-- 测试边界条件和特殊字符处理
SELECT * FROM test_table 
WHERE name LIKE '%test%';  -- 使用通配符测试

-- 测试事务控制
BEGIN;
    INSERT INTO test_table (name, age, is_active) VALUES ('Eve', 35, TRUE);
    UPDATE test_table SET is_active = FALSE WHERE name = 'Alice';
COMMIT;

-- 测试权限相关操作
GRANT SELECT ON test_table TO public;
REVOKE SELECT ON test_table FROM public;

-- 清理测试表（如果需要）
DROP TABLE IF EXISTS test_table;